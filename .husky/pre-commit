#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# Check for potential secrets
echo "ğŸ” Scanning for secrets..."

# Check for common secret patterns
if git diff --cached --name-only | xargs grep -E "sk_live_|pk_live_|AKIA[0-9A-Z]{16}" 2>/dev/null; then
  echo "âŒ ERROR: Potential secret detected in staged files!"
  echo "Please remove secrets before committing."
  exit 1
fi

# Check for .env files
if git diff --cached --name-only | grep -E "^\.env$|/\.env$" 2>/dev/null; then
  echo "âŒ ERROR: .env file detected in staged files!"
  echo ".env files should never be committed."
  exit 1
fi

echo "âœ… No secrets detected"

# Run linting
pnpm lint-staged
